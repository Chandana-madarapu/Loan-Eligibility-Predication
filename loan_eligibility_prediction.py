# -*- coding: utf-8 -*-
"""Loan Eligibility Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1EVFj5R8y_39rwI4cXq3bFH6pN-szVe_Y
"""

import numpy as np
import pandas as pd
from sklearn.preprocessing import LabelEncoder
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score
import matplotlib.pyplot as plt
import seaborn as sns

# Load data
loan_train = pd.read_csv('loan-train.csv')
loan_test = pd.read_csv('loan-test.csv')



# Data preprocessing
loan_train['Credit_History'].fillna(loan_train['Credit_History'].mode(), inplace=True)
loan_test['Credit_History'].fillna(loan_test['Credit_History'].mode(), inplace=True)

loan_train['LoanAmount'].fillna(loan_train['LoanAmount'].mean(), inplace=True)
loan_test['LoanAmount'].fillna(loan_test['LoanAmount'].mean(), inplace=True)

loan_train.Loan_Status = loan_train.Loan_Status.replace({"Y": 1, "N": 0})
loan_train.Gender = loan_train.Gender.replace({"Male": 1, "Female": 0})
loan_test.Gender = loan_test.Gender.replace({"Male": 1, "Female": 0})
loan_train.Married = loan_train.Married.replace({"Yes": 1, "No": 0})
loan_test.Married = loan_test.Married.replace({"Yes": 1, "No": 0})
loan_train.Self_Employed = loan_train.Self_Employed.replace({"Yes": 1, "No": 0})
loan_test.Self_Employed = loan_test.Self_Employed.replace({"Yes": 1, "No": 0})

loan_train['Gender'].fillna(loan_train['Gender'].mode()[0], inplace=True)
loan_test['Gender'].fillna(loan_test['Gender'].mode()[0], inplace=True)
loan_train['Dependents'].fillna(loan_train['Dependents'].mode()[0], inplace=True)
loan_test['Dependents'].fillna(loan_test['Dependents'].mode()[0], inplace=True)
loan_train['Married'].fillna(loan_train['Married'].mode()[0], inplace=True)
loan_test['Married'].fillna(loan_test['Married'].mode()[0], inplace=True)
loan_train['Credit_History'].fillna(loan_train['Credit_History'].mean(), inplace=True)
loan_test['Credit_History'].fillna(loan_test['Credit_History'].mean(), inplace=True)

# Encode categorical features
feature_col = ['Property_Area', 'Education', 'Dependents']
le = LabelEncoder()
for col in feature_col:
    loan_train[col] = le.fit_transform(loan_train[col])
    loan_test[col] = le.fit_transform(loan_test[col])

# Visualization
plt.figure(figsize=(12, 6))
sns.heatmap(loan_train.drop('Loan_ID', axis=1).corr(), cmap='coolwarm', annot=True, fmt='.1f', linewidths=.1)
plt.title('Correlation Matrix - Train Dataset')
plt.show()
print()

plt.figure(figsize=(12, 6))
sns.heatmap(loan_test.drop('Loan_ID', axis=1).corr(), cmap='coolwarm', annot=True, fmt='.1f', linewidths=.1)
plt.title('Correlation Matrix - Test Dataset')
plt.show()
print()

plt.figure(figsize=(18, 6))
plt.subplot(1, 2, 1)
loan_train['ApplicantIncome'].hist(bins=10)
plt.title("Loan Application Amount - Train Dataset")

plt.subplot(1, 2, 2)
plt.grid()
plt.hist(np.log(loan_train['LoanAmount']))
plt.title("Log Loan Application Amount - Train Dataset")
plt.show()
print()

plt.figure(figsize=(18, 6))
plt.title("Relation Between Applicant Income vs Loan Amount - Train Dataset")
plt.grid()
plt.scatter(loan_train['ApplicantIncome'], loan_train['LoanAmount'], c='k', marker='x')
plt.xlabel("Applicant Income")
plt.ylabel("Loan Amount")
plt.show()
print()

# Model training
logistic_model = LogisticRegression()
train_features = ['Credit_History', 'Education', 'Gender']
x_train = loan_train[train_features].values
y_train = loan_train['Loan_Status'].values
x_test = loan_test[train_features].values
logistic_model.fit(x_train, y_train)

# Model evaluation
score = logistic_model.score(x_train, y_train)
print('Coefficient of model:', logistic_model.coef_)
print('Intercept of model:', logistic_model.intercept_)
print('Accuracy Score:', round(score * 100, 2))

# Predictions on test data
predicted_test = logistic_model.predict(x_test)
print('Target on test data:', predicted_test)









